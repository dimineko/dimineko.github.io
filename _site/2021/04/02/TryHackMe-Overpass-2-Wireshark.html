<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>TryHackMe Overpass 2 - Wireshark | El baúl de Diego</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="TryHackMe Overpass 2 - Wireshark" />
<meta name="author" content="Diego Martín dos Santos" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="En este post aprenderemos a movernos de manera básica por Wireshark y a filtrar los paquetes." />
<meta property="og:description" content="En este post aprenderemos a movernos de manera básica por Wireshark y a filtrar los paquetes." />
<link rel="canonical" href="http://localhost:4000/2021/04/02/TryHackMe-Overpass-2-Wireshark.html" />
<meta property="og:url" content="http://localhost:4000/2021/04/02/TryHackMe-Overpass-2-Wireshark.html" />
<meta property="og:site_name" content="El baúl de Diego" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-02T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TryHackMe Overpass 2 - Wireshark" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/2021/04/02/TryHackMe-Overpass-2-Wireshark.html","headline":"TryHackMe Overpass 2 - Wireshark","dateModified":"2021-04-02T00:00:00+02:00","datePublished":"2021-04-02T00:00:00+02:00","author":{"@type":"Person","name":"Diego Martín dos Santos"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/04/02/TryHackMe-Overpass-2-Wireshark.html"},"description":"En este post aprenderemos a movernos de manera básica por Wireshark y a filtrar los paquetes.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="El baúl de Diego" /></head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">El baúl de Diego<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-purple-hover" href="https://github.com/dimineko"><i class="fab fa-github-square"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">
    
    
        <img src="
            https://gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=256
        " class="author-avatar" alt="Avatar" />
    
Cybersecurity Enthusiast & Geek
</div>


<div class="post">
  <h1 class="post-title">TryHackMe Overpass 2 - Wireshark</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/tryhackme,/">tryhackme,</a>
      
      <a class="tag" href="/tag/wireshark/">wireshark</a>
      
  </div>
  
  <div class="post-date">Published on 02 Apr 2021</div>
  
  <noscript>
    <div class="post-description">En este post aprenderemos a movernos de manera básica por Wireshark y a filtrar los paquetes.</div>
  </noscript>
  <div id="animated-post-description" class="post-description" style="display: none;"></div>
  
  <h1 id="máquina-tryhackme-overpass-2">Máquina TryHackMe: Overpass 2</h1>

<p>Máquina de la plataforma de TryHackMe que trata sobre análisis de paquetes.</p>

<p>Aprenderemos:</p>
<ul>
  <li>A movernos por Wireshark.</li>
  <li>A leer Wireshark de una forma eficiente.</li>
  <li>A aplicar filtros a Wireshark.</li>
</ul>

<h1 id="cúal-era-la-url-de-la-página-que-se-uso-para-subir-la-reverse-shell">¿Cúal era la URL de la página que se uso para subir la reverse shell?</h1>

<p>Para responder a esta pregunta lo primero que tenemos que entender es que para subir y bajar ficheros se usa el protocolo HTTP, con sus distintos métodos.
Por eso, para responder a esta cuestión, filtraremos todos los paquetes por el protocolo HTTP, de la siguiente manera:</p>

<p><a href="https://ibb.co/9qdsLsv"><img src="https://i.ibb.co/BgYqxqP/HTTP.png" alt="HTTP" border="0" /></a></p>

<p>Así conseguiremos reducir drastricamente el numero de paquetes a revisar . ( De 3896 a 15 paquetes, eso es ahorrar muchisimo tiempo, analizaremos solo un 0,3 % de los paquetes totales del fichero .pcap)</p>

<p>Con estos paquetes, iremos uno por uno siguiendo la trama TCP, para analizarlo más en profundidad.</p>

<p>Si nos fijamos, en la pestaña “INFO” de cada paquete, nos pone que se ha realizado una peitición HTTP post a /upload.php, lo cual nos da a entender que se ha subido un fichero, lo cual es interesante, asi que lo analizaremos siguiendo la trama TCP…</p>

<p><a href="https://ibb.co/9qdsLsv"><img src="https://i.ibb.co/BgYqxqP/HTTP.png" alt="HTTP" border="0" /></a></p>

<p>Aqui es donde descubriremos la segunda respuesta: El payload.</p>

<p>Seguiremos la trama TCP y nos daremos cuenta de que ahí se encontrará el payload.</p>

<p><a href="https://ibb.co/LN7wjvB"><img src="https://i.ibb.co/J3JL6C8/payload.png" alt="payload" border="0" /></a></p>

<h1 id="q2-qué-contraseña-uso-el-atacante-para-conseguir-escalar-privilegios">Q2: ¿Qué contraseña uso el atacante para conseguir escalar privilegios?</h1>

<p>Aquí, tras haber leído todas las peticiones HTTP previamente filtrada, me puse a pensar…</p>

<p>¿Cómo habra realizado la escalada de privilegios, si usó una reverse shell con PHP?</p>

<p>Y llegué a la conclusión de que la habría conseguido mediante NETCAT (aka nc).</p>

<p>Por tanto me puse a investigar los paquetes TCP, el problema es que había muchisimos. Y otra vez tocaba pensar…¿Cómo hago un vistazo rápido, que estoy buscando? Y la respuesta fue: La escalada de privilegios, son comandos, mucho texto, datos, data… Basicamente estabamos buscando una trama “grande”, con muchos datos, comandos, input(comandos) y output(salida de esos comandos)…</p>

<p>Asi que simplemente me puse a ver las peticiones las cuales su lenght era superior a la media (que rondaba entre 60-70, las cuales son muchísimas, por tanto ordené los paquetes según su length.</p>

<p>Tras apenas un minuto siguiendo las tramas de estas peticiones, llegue a una que contenía un LENGTH de 121. Lo que me llamo la atención de esta petición no fue el LENGTH , fue que contenía “DATA”.</p>

<p><a href="https://ibb.co/h25HBTP"><img src="https://i.ibb.co/7rcVn0w/image.png" alt="image" border="0" /></a></p>

<p>Me puse a leerlo (<code class="language-plaintext highlighter-rouge">Follow TCP Stream, Seguir trama TCP...</code>), y lo que contenía resultó ser todo lo que pasaba por NC (netcat). Ahí se encontraba varias respuestas sobre los hashes, simplemente hay que leerlo y encuentras tanto el hash como la salt.</p>

<p><a href="https://ibb.co/kGBt4FV"><img src="https://i.ibb.co/Prjdc8s/image.png" alt="image" border="0" /></a></p>

<h1 id="cómo-crackear-la-contraseña-hasheada">¿Cómo crackear la contraseña hasheada?</h1>

<p>Antes de seguir adelante hay que entender que un hash tiene salt.
Por tanto,crackear el “hash” de la pregunta de <code class="language-plaintext highlighter-rouge">THM</code> que contestamos antes, darias error. Esto es debido a que el formato requerido para crackear es “HASH:SALT”.</p>

<p><a href="https://imgbb.com/"><img src="https://i.ibb.co/SB6n98N/hashwithsalt.png" alt="hashwithsalt" border="0" /></a></p>

<p>Cuando lo tengamos guardado en un fichero <code class="language-plaintext highlighter-rouge">P.EJ: hash</code> deberemos lanzar alguna herramientas para crackearla.
En mi caso usé hashcat con la wordlist recomendada por ´´THM´´ : fasttrack.</p>

<p><a href="https://ibb.co/V2YnghZ"><img src="https://i.ibb.co/pJjVfs8/image.png" alt="image" border="0" /></a></p>

<h1 id="conseguir-la-flag-usertxt">Conseguir la flag User.txt</h1>

<p>Primero que todo realize un escaneo de puertos con nmap. 
El escaneo de nmap arrojó como resultado, entre otro muchos, el puerto 22 abierto.</p>

<p>Así que lo primero que se me ocurrió fue lanzar un ataque de fuerza bruta por SSH con hydra.
En los usuarios puse todos los del fichero shadow que encontramos en el fichero Wireshark,</p>

<h1 id="conseguir-la-flag-roottxt">Conseguir la flag root.txt</h1>

<p>Al entrar como user , comprobe <code class="language-plaintext highlighter-rouge">"ls -la".</code></p>

<p>Encontre el fichero <code class="language-plaintext highlighter-rouge">".suid_bash"</code></p>

<p>Intente leerlo pero era ilegible, pero si nos penemos a pensar en la situación,el atacante puede haber dejado algun archivo para escalar privilegios facilmente, (se sobreentiende por el nombre del fichero y el contexto de la maquina de TryHackMe)</p>

<p>Ejecutamos el ficheros, comprobamos permisos, y vemos que nada ha pasado , seguimos teniendo el euid de James ( se comprueba con el comando <code class="language-plaintext highlighter-rouge">id</code>), aunque el prompt cambio. Esto nos confirma que el script está jugando con la shell y los permisos…</p>

<p><a href="https://ibb.co/0hZ3gf5"><img src="https://i.ibb.co/SR0phKS/suid-james.png" alt="suid-james" border="0" /></a></p>

<p>Por suerte se me ocurrió probar con la flag <code class="language-plaintext highlighter-rouge">-p</code> (para mantener los permisos de ejecuccion del script) y funcionó.</p>

<p><a href="https://ibb.co/27sVtFB"><img src="https://i.ibb.co/VWQnSL8/image.png" alt="image" border="0" /></a></p>

<p>Como vemos se nos mantuvo el<code class="language-plaintext highlighter-rouge">euid=0</code>, que corresponde a root, aunque seguimos siendo james, tenemos permisos de root.</p>

<p>Por tanto ya solo nos queda sacar la flag de root:</p>

<p><a href="https://imgbb.com/"><img src="https://i.ibb.co/XjB9sdp/image.png" alt="image" border="0" /></a></p>

<h1 id="agradecimientos">Agradecimientos</h1>
<p><a href="https://www.youtube.com/watch?v=XtySdRYCbiY">John Hammond (TryHackMe! Overpass 2 Recovering from THE HACK)</a></p>


</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'http://localhost:4000/2021/04/02/TryHackMe-Overpass-2-Wireshark.html';
     this.page.identifier = '/2021/04/02/TryHackMe Overpass 2 - Wireshark';
     this.page.title = 'TryHackMe Overpass 2 - Wireshark';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//bitbrain-github-io.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/04/30/LD-PRELOAD.html">
            Explotación de la vulnerabilidad LD_PRELOAD Capabilties
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/04/28/Writeup-coldbox.html">
            Writeup: Tryhackme ColddBox.
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/04/27/Windows-Pentesting-CheatSheet.html">
            Windows Pentesting CheatSheet
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/ejpt%2Celearn%2Ccertificacio/" class="set-5">ejpt,elearn,certificacio</a> <a href="/tag/ld%2Ccapabilities%2Cexplotacion%2Cprivesc/" class="set-1">ld,capabilities,explotacion,privesc</a> <a href="/tag/shell%2Creverse/" class="set-1">shell,reverse</a> <a href="/tag/tryhackme%2C/" class="set-1">tryhackme,</a> <a href="/tag/vulnerabilidad/" class="set-5">vulnerabilidad</a> <a href="/tag/wireshark/" class="set-1">wireshark</a></div>
  




<script>
  let i = 0;
  const text = 'En este post aprenderemos a movernos de manera básica por Wireshark y a filtrar los paquetes.';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
